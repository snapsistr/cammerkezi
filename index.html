<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Cam Hesaplama | Isıcam & Çiftcam Fiyat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; }
        .container { max-width: 700px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
        h1 { text-align: center; color: #0a4974; }
        label { display: block; margin-top: 15px; margin-bottom: 5px; }
        input, select { padding: 8px; border: 1px solid #bbb; border-radius: 5px; }
        input[type="number"] { width: 90px; }
        select { width: 120px; }
        .form-row { display: flex; flex-wrap: wrap; gap: 15px; align-items: end; }
        button { background: #0a4974; color: #fff; padding: 10px 18px; border: none; border-radius: 6px; font-size: 15px; cursor: pointer; }
        button:hover { background: #08365a; }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; }
        th, td { border: 1px solid #d7e9f5; padding: 8px 5px; text-align: center; }
        th { background: #ecf6fb; }
        .toplamlar { text-align: right; margin-top: 20px; font-size: 1.1em; }
        .panel-link { text-align: center; margin-top: 18px; }
        .panel-link a { color: #0a4974; text-decoration: underline; }
        .sil-btn { background: #d12b2b; color: #fff; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;}
        .sil-btn:hover { background: #8a1919; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cam Fiyatı Hesaplama</h1>
        <form id="camForm" class="form-row" onsubmit="ekleOlcu(event)">
            <div>
                <label for="camTipi">Cam Tipi</label>
                <select id="camTipi" required>
                    <option value="isicam">Isıcam</option>
                    <option value="ciftcam">Çiftcam</option>
                </select>
            </div>
            <div>
                <label for="en">En (cm)</label>
                <input type="number" id="en" min="1" step="0.1" required placeholder="En">
            </div>
            <div>
                <label for="boy">Boy (cm)</label>
                <input type="number" id="boy" min="1" step="0.1" required placeholder="Boy">
            </div>
            <div>
                <button type="submit">Ekle</button>
            </div>
        </form>

        <table id="olcuTablosu" style="display:none;">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Cam Tipi</th>
                    <th>En (cm)</th>
                    <th>Boy (cm)</th>
                    <th>m²</th>
                    <th>Fiyat (TL)</th>
                    <th>Sil</th>
                </tr>
            </thead>
            <tbody id="olcuTabloBody">
            </tbody>
        </table>

        <div class="toplamlar" id="toplamlar" style="display:none;">
            <b>Toplam m²:</b> <span id="toplamM2">0</span> &nbsp;&nbsp;
            <b>Toplam Fiyat:</b> <span id="toplamFiyat">0</span> TL
        </div>

        <div class="panel-link">
            <a href="admin.html" target="_blank">Yönetici Paneli (Fiyat Ayarları)</a>
        </div>
    </div>

    <script>
        // Varsayılan fiyatlar (localStorage'dan al, yoksa default değer ata)
        function getFiyatlar() {
            let fiyatlar = localStorage.getItem('camFiyatlari');
            if (fiyatlar) return JSON.parse(fiyatlar);
            return { isicam: 900, ciftcam: 1150 };
        }

        function birimFiyat(tip) {
            const fiyatlar = getFiyatlar();
            return fiyatlar[tip];
        }

        let olculer = [];

        function ekleOlcu(e) {
            e.preventDefault();
            const camTipi = document.getElementById('camTipi').value;
            const en = parseFloat(document.getElementById('en').value);
            const boy = parseFloat(document.getElementById('boy').value);

            if (en <= 0 || boy <= 0) {
                alert("En ve boy pozitif değerler olmalı.");
                return;
            }

            // m² hesapla
            const m2 = (en / 100) * (boy / 100);
            const m2_kes = Math.max(m2, 0.3); // Minimum m2 (opsiyonel)
            const fiyat = (m2_kes * birimFiyat(camTipi)).toFixed(2);

            olculer.push({ camTipi, en, boy, m2, m2_kes, fiyat });

            guncelleTablo();

            // Formu temizle
            document.getElementById('en').value = '';
            document.getElementById('boy').value = '';
            document.getElementById('camTipi').focus();
        }

        function guncelleTablo() {
            const tbody = document.getElementById('olcuTabloBody');
            tbody.innerHTML = "";
            let toplamM2 = 0;
            let toplamFiyat = 0;

            olculer.forEach((olcu, i) => {
                toplamM2 += olcu.m2_kes;
                toplamFiyat += parseFloat(olcu.fiyat);

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${i+1}</td>
                    <td>${olcu.camTipi === "isicam" ? "Isıcam" : "Çiftcam"}</td>
                    <td>${olcu.en}</td>
                    <td>${olcu.boy}</td>
                    <td>${olcu.m2.toFixed(3)}<br><span style="color:#888;font-size:11px">(Fiyat için: ${olcu.m2_kes.toFixed(3)})</span></td>
                    <td>${olcu.fiyat} TL</td>
                    <td><button class="sil-btn" onclick="silOlcu(${i})">Sil</button></td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('olcuTablosu').style.display = olculer.length ? 'table' : 'none';
            document.getElementById('toplamlar').style.display = olculer.length ? 'block' : 'none';
            document.getElementById('toplamM2').textContent = toplamM2.toFixed(3);
            document.getElementById('toplamFiyat').textContent = toplamFiyat.toFixed(2);
        }

        function silOlcu(i) {
            olculer.splice(i, 1);
            guncelleTablo();
        }

        // Fiyatlar güncellenirse anında yansısın
        window.addEventListener('storage', function(event) {
            if (event.key === 'camFiyatlari') guncelleTablo();
        });
    </script>
</body>
</html>